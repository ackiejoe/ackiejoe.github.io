<!DOCTYPE html>
<html lang="en">
<head>
  <link href="https://cdn.jsdelivr.net/npm/daisyui@4.10.2/dist/full.css" rel="stylesheet" type="text/css" />
  <meta charset="UTF-8">
  <title>My Links</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
  // DaisyUI plugin is loaded automatically via CDN
      daisyui: {
        themes: [
          "light", "dark", "cupcake", "bumblebee", "emerald", "corporate", "synthwave", "retro", "cyberpunk", "valentine", "halloween", "garden", "forest", "aqua", "lofi", "pastel", "fantasy", "wireframe", "black", "luxury", "dracula", "cmyk", "autumn", "business", "acid", "lemon", "night", "coffee", "winter"
        ]
      }
    }
  </script>
  <script src="daisyui-themes.js"></script>
</head>
<body class="bg-base-200 min-h-screen flex flex-col items-center justify-start p-6">
  <!-- Header -->
  <header class="w-full flex justify-between items-center mb-6 px-8 py-4 bg-base-300">
    <h1 class="text-3xl font-bold text-primary">My Links</h1>
    <div>
      <select id="themeSelect" class="select select-bordered w-full max-w-xs"></select>
    </div>
  </header>
  <main class="w-full max-w-[1100px] mx-auto">
    <form id="googleSearchForm" class="flex gap-2 mb-4">
  <input type="text" id="googleSearchInput" placeholder="Google Search" class="input input-bordered w-full" required>
  <button type="submit" class="btn btn-success">Search</button>
    </form>
    <h1 class="text-3xl font-bold mb-6 text-center text-blue-600">My Links</h1>
    <div id="linksGrid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 mt-4"></div>
    <!-- Modal -->
    <div id="modalOverlay" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
      <div id="modalBox" class="bg-white rounded-lg shadow-lg p-8 w-full max-w-md flex flex-col items-center">
        <h2 id="modalTitle" class="text-2xl font-bold mb-6 text-center w-full"></h2>
        <form id="modalForm" class="w-full flex flex-col gap-4 items-center">
          <input type="text" id="modalLinkTitle" name="modalLinkTitle" placeholder="Title" class="input input-bordered w-full text-lg">
          <input type="text" id="modalLinkUrl" name="modalLinkUrl" placeholder="URL (optional)" class="input input-bordered w-full text-lg">
          <div class="flex gap-4 justify-center w-full mt-2">
            <button type="submit" class="btn btn-primary">Save</button>
            <button type="button" id="modalCancel" class="btn btn-ghost">Cancel</button>
          </div>
        </form>
      </div>
    </div>
  </main>
  <script>
    // Dynamically populate theme options from window.Themes
    function populateThemeOptions() {
      const themeSelect = document.getElementById('themeSelect');
      themeSelect.innerHTML = '';
      window.DaisyUIThemes.forEach(theme => {
        const opt = document.createElement('option');
        opt.value = theme;
        opt.textContent = theme.charAt(0).toUpperCase() + theme.slice(1);
        themeSelect.appendChild(opt);
      });
    }
    // Use window.Themes for theme logic
    function applyTheme(theme) {
  console.log('applyTheme called with:', theme);
  document.documentElement.setAttribute('data-theme', theme);
  console.log('data-theme set to:', document.documentElement.getAttribute('data-theme'));
  }
    
    function getTheme() {
      return localStorage.getItem('linksTheme') || 'dark';
    }
    function setTheme(theme) {
  console.log('setTheme called with:', theme);
  localStorage.setItem('linksTheme', theme);
  applyTheme(theme);
  document.getElementById('themeSelect').value = theme;
    }
    document.getElementById('themeSelect').onchange = function() {
  console.log('themeSelect onchange:', this.value);
  setTheme(this.value);
    };
    // Initial theme and options
    populateThemeOptions();
    setTheme(getTheme());
    // Google search form handler
    document.getElementById('googleSearchForm').onsubmit = function(e) {
      e.preventDefault();
      const query = document.getElementById('googleSearchInput').value.trim();
      if (query) {
        window.open('https://www.google.com/search?q=' + encodeURIComponent(query), '_blank');
        this.reset();
      }
    };
    // Load links from localStorage
    function getLinks() {
      return JSON.parse(localStorage.getItem('myLinks') || '[]');
    }
    function saveLinks(links) {
      localStorage.setItem('myLinks', JSON.stringify(links));
    }
    function renderLinks() {
      const links = getLinks();
      const grid = document.getElementById('linksGrid');
      grid.innerHTML = '';
      if (links.length === 0) {
        // Show blank card with large + icon and empty state message
        const square = document.createElement('div');
  square.className = 'card bg-base-100 shadow-xl border border-base-300 flex flex-col items-center justify-center cursor-pointer';
        square.style.width = '200px';
        square.style.height = '200px';
        square.innerHTML = `
          <button id="addFirstLink" type="button" class="flex flex-col items-center justify-center w-full h-full" tabindex="0" aria-label="Add Link">
            <div class="flex items-center justify-center w-16 h-16 rounded-full bg-blue-100 mb-2">
              <svg class="w-12 h-12 text-blue-500" fill="currentColor" viewBox="0 0 24 24"><path d="M12 5v14m7-7H5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </div>
            <span class="theme-text text-lg">Add Link</span>
          </button>
        `;
        grid.appendChild(square);
        // Empty state message
        const msg = document.createElement('div');
        msg.className = 'w-full text-center mt-6 text-gray-500';
        msg.textContent = 'No links yet. Click the + to add your first link.';
        grid.parentElement.insertBefore(msg, grid.nextSibling);
        const addBtn = document.getElementById('addFirstLink');
        addBtn.onclick = function(e) {
          e.preventDefault();
          console.log('Add Link button clicked');
          showModal('Add New Link', '', '', null);
        };
      } else {
        links.forEach((link, idx) => {
          const square = document.createElement('div');
          square.className = 'card bg-base-100 shadow-xl border border-base-300 flex flex-col items-center justify-center';
          square.style.width = '200px';
          square.style.height = '200px';
          // Get favicon using DuckDuckGo's favicon API
          let favicon = '';
          try {
            const urlObj = new URL(link.url);
            favicon = `https://icons.duckduckgo.com/ip3/${urlObj.hostname}.ico`;
          } catch (e) {
            favicon = '';
          }
          square.innerHTML = `
            <a href="${link.url}" target="_blank" class="flex flex-col items-center justify-center w-full h-full">
              <div class="flex items-center justify-center w-12 h-12 rounded-full bg-blue-100 mb-2">
                ${favicon ? `<img src="${favicon}" alt="icon" class="w-8 h-8 rounded" onerror="this.style.display='none'">` : `<svg class="w-8 h-8 text-blue-500" fill="currentColor" viewBox="0 0 20 20"><path d="M10 2a8 8 0 100 16 8 8 0 000-16zm1 11H9v-1h2v1zm0-2H9V7h2v4z"/></svg>`}
              </div>
              <span class="theme-text">${link.title}</span>
            </a>
            <button class="absolute top-2 right-2 transition z-20" data-menu="${idx}">
              <svg class="w-6 h-6 text-gray-500" fill="currentColor" viewBox="0 0 20 20"><circle cx="4" cy="10" r="2"/><circle cx="10" cy="10" r="2"/><circle cx="16" cy="10" r="2"/></svg>
            </button>
            <div class="absolute -top-2 left-1/2 -translate-x-1/2 custom-menu theme-border rounded shadow-lg z-30 flex-col min-w-[120px]" id="menu-${idx}" style="display:none;">
              <button class="px-4 py-2 text-left hover:bg-gray-100 w-full" data-edit="${idx}">Edit</button>
              <button class="px-4 py-2 text-left hover:bg-gray-100 w-full" data-delete="${idx}">Delete</button>
              <button class="px-4 py-2 text-left hover:bg-gray-100 w-full" data-add>New</button>
            </div>
          `;
          grid.appendChild(square);
        });
      }
      applyTheme(getTheme());
    }
  // Removed orphaned linkForm submit handler
    // Menu logic
    let openMenu = null;
    document.getElementById('linksGrid').onclick = function(e) {
      // Show/hide menu
      if (e.target.closest('button[data-menu]')) {
          const btn = e.target.closest('button[data-menu]');
          const idx = btn.dataset.menu;
            // console.log('Menu button clicked', {btn, idx});
          const menu = document.getElementById('menu-' + idx);
          if (!menu) {
                // console.error('Menu not found for idx', idx);
            return;
          }
          // If menu is already visible, hide it
          if (menu.style.display === 'flex') {
            menu.style.display = 'none';
            openMenu = null;
                // console.log('Menu already visible, hiding', menu.id);
            return;
          }
          // Otherwise, hide all menus and show this one
          document.querySelectorAll('[id^="menu-"]').forEach(m => {
            m.style.display = 'none';
        // console.log('Hiding menu', m.id);
          });
          menu.style.display = 'flex';
          openMenu = menu;
      // console.log('Showing menu', menu.id);
          return;
      }
      // Edit
      if (e.target.dataset.edit !== undefined) {
        const idx = +e.target.dataset.edit;
        const links = getLinks();
        showModal('Edit Link', links[idx].title, links[idx].url, idx);
        if (openMenu) openMenu.classList.add('hidden');
        openMenu = null;
        return;
      }
      // Delete
      if (e.target.dataset.delete !== undefined) {
        const idx = +e.target.dataset.delete;
        if (confirm('Are you sure you want to delete this link?')) {
          const links = getLinks();
          links.splice(idx, 1);
          saveLinks(links);
          renderLinks();
        }
        if (openMenu) openMenu.style.display = 'none';
        openMenu = null;
        return;
      }
      // Add new
      if (e.target.dataset.add !== undefined) {
        showModal('Add New Link', '', '', null);
        if (openMenu) openMenu.classList.add('hidden');
        openMenu = null;
        return;
      }
    };
    // Close menu on outside click
    document.addEventListener('click', function(e) {
      if (openMenu && !e.target.closest('.group')) {
        openMenu.classList.add('hidden');
        openMenu = null;
      }
    });
    // Modal logic
    function showModal(title, linkTitle, linkUrl, idx) {
      const modalTitle = document.getElementById('modalTitle');
      const modalLinkTitle = document.getElementById('modalLinkTitle');
      const modalLinkUrl = document.getElementById('modalLinkUrl');
      const modalOverlay = document.getElementById('modalOverlay');
      let modalForm = document.getElementById('modalForm');
      if (!modalForm) {
        modalForm = document.querySelector('#modalOverlay form');
        console.log('Fallback modalForm:', modalForm);
      }
      const modalCancel = document.getElementById('modalCancel');
      console.log('showModal called', {modalTitle, modalLinkTitle, modalLinkUrl, modalOverlay, modalForm, modalCancel});
      if (!modalTitle || !modalLinkTitle || !modalLinkUrl || !modalOverlay || !modalForm || !modalCancel) {
        console.error('Modal element missing');
        return;
      }
      modalTitle.textContent = title;
      modalLinkTitle.value = linkTitle || '';
      modalLinkUrl.value = linkUrl || '';
      modalOverlay.classList.remove('hidden');
      console.log('modalOverlay should now be visible', modalOverlay.classList);
      setTimeout(() => { modalLinkTitle.focus(); }, 100);
      // Remove previous listeners
      modalForm.onsubmit = null;
      modalCancel.onclick = null;
      // Add listeners
      modalForm.onsubmit = function(e) {
        e.preventDefault();
        const title = modalLinkTitle.value.trim();
        const url = modalLinkUrl.value.trim();
        if (!title || title.length < 2) {
          modalLinkTitle.classList.add('ring-2', 'ring-red-500');
          modalLinkTitle.focus();
          return;
        } else {
          modalLinkTitle.classList.remove('ring-2', 'ring-red-500');
        }
        const links = getLinks();
        if (idx !== null && idx !== undefined) {
          links[idx] = { title, url };
        } else {
          links.push({ title, url });
        }
        saveLinks(links);
        renderLinks();
        modalOverlay.classList.add('hidden');
      };
      modalCancel.onclick = function() {
        modalOverlay.classList.add('hidden');
      };
    }
    renderLinks();
  </script>
</body>
</html>
